### 5. 임베디드 소프트웨어 개발

#### 5.1. 실시간 운영체제 (RTOS) 개요

실시간 운영체제(RTOS, Real-Time Operating System)는 임베디드 시스템에서 실시간 응용 프로그램을 실행하기 위한 운영체제입니다. RTOS는 시간 제한이 있는 작업을 정확하고 신뢰성 있게 수행하도록 설계되었습니다. 이를 통해 여러 태스크를 효과적으로 관리하고, 정해진 시간 내에 작업을 완료할 수 있습니다.

##### RTOS의 주요 특징

1. **태스크 관리**:
   - **멀티태스킹**: RTOS는 여러 태스크를 동시에 실행할 수 있는 멀티태스킹 환경을 제공합니다.
   - **태스크 우선순위**: 각 태스크는 우선순위를 가지며, RTOS는 높은 우선순위의 태스크를 우선 실행합니다.

2. **실시간 스케줄링**:
   - **선점형 스케줄링**: 높은 우선순위의 태스크가 실행 중일 때, 더 높은 우선순위의 태스크가 발생하면 현재 태스크를 중단하고 새로운 태스크를 실행합니다.
   - **비선점형 스케줄링**: 태스크가 자발적으로 CPU를 반환할 때까지 실행됩니다.

3. **동기화 및 통신**:
   - **세마포어**: 태스크 간의 자원 접근을 제어하기 위한 동기화 도구입니다.
   - **뮤텍스**: 상호 배제를 통해 한 번에 하나의 태스크만이 특정 자원에 접근할 수 있도록 합니다.
   - **큐**: 태스크 간의 메시지 전달을 위한 FIFO(First In, First Out) 데이터 구조입니다.

4. **시간 관리**:
   - **타이머**: 주기적인 작업을 수행하기 위한 타이머 기능을 제공합니다.
   - **딜레이 함수**: 특정 시간 동안 태스크 실행을 지연시킵니다.

##### RTOS의 주요 구성 요소

1. **커널**: RTOS의 핵심 부분으로, 태스크 스케줄링, 메모리 관리, 인터럽트 처리 등을 담당합니다.
2. **태스크**: 실행 가능한 프로그램의 단위입니다. 각 태스크는 독립적으로 실행되며, 고유의 스택과 상태를 가집니다.
3. **인터럽트 서비스 루틴(ISR)**: 하드웨어 인터럽트가 발생할 때 실행되는 코드입니다.
4. **동기화 객체**: 세마포어, 뮤텍스, 이벤트 플래그 등과 같은 객체로, 태스크 간의 동기화와 통신을 관리합니다.

##### 예제: FreeRTOS 기본 사용법

FreeRTOS는 널리 사용되는 오픈 소스 실시간 운영체제로, 다양한 마이크로컨트롤러에서 사용할 수 있습니다.

**1. 프로젝트 설정**

FreeRTOS를 사용하는 프로젝트를 설정합니다. FreeRTOS 라이브러리를 다운로드하고, 프로젝트에 추가합니다.

**2. 태스크 생성**

FreeRTOS에서 태스크를 생성하고 실행하는 예제입니다.

**main.c 예제 코드**:
```c
#include <FreeRTOS.h>
#include <task.h>
#include <semphr.h>
#include "stm32f4xx.h"

void vTask1(void *pvParameters);
void vTask2(void *pvParameters);

int main(void) {
    SystemInit();
    HAL_Init();

    xTaskCreate(vTask1, "Task 1", 100, NULL, 1, NULL);
    xTaskCreate(vTask2, "Task 2", 100, NULL, 2, NULL);

    vTaskStartScheduler();

    while (1) {
        // 메인 루프
    }
}

void vTask1(void *pvParameters) {
    while (1) {
        // Task 1 실행 코드
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5); // PA5 핀 상태 토글
        vTaskDelay(pdMS_TO_TICKS(1000)); // 1초 지연
    }
}

void vTask2(void *pvParameters) {
    while (1) {
        // Task 2 실행 코드
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_6); // PA6 핀 상태 토글
        vTaskDelay(pdMS_TO_TICKS(500)); // 0.5초 지연
    }
}
```

##### RTOS의 장점과 단점

**장점**:
- **실시간 응답**: RTOS는 정해진 시간 내에 작업을 완료하여 실시간 응답이 필요한 시스템에 적합합니다.
- **효율적인 자원 관리**: 태스크 우선순위와 선점형 스케줄링을 통해 시스템 자원을 효율적으로 관리합니다.
- **모듈화된 설계**: 태스크 기반의 설계를 통해 코드의 모듈화와 유지 보수가 용이합니다.

**단점**:
- **복잡성 증가**: RTOS 기반 시스템은 비RTOS 시스템에 비해 복잡도가 높아질 수 있습니다.
- **오버헤드**: RTOS의 기능을 지원하기 위한 오버헤드가 발생할 수 있습니다.
- **디버깅 어려움**: 다중 태스크와 실시간 특성으로 인해 디버깅이 어려울 수 있습니다.

RTOS는 임베디드 시스템에서 실시간 성능을 요구하는 응용 프로그램을 효과적으로 관리하고 실행하기 위한 중요한 도구입니다. 각 프로젝트의 요구 사항에 따라 적절한 RTOS를 선택하고, 그 기능을 잘 활용하여 안정적이고 효율적인 시스템을 구현하는 것이 중요합니다.
