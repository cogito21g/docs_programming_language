### 7. 전력 관리

#### 7.1. 저전력 설계 기법

임베디드 시스템에서는 배터리 수명을 최대화하기 위해 전력 관리는 매우 중요합니다. 저전력 설계 기법을 통해 에너지 소비를 줄이고, 시스템의 효율성을 높일 수 있습니다. 이러한 기법은 하드웨어와 소프트웨어 모두에서 적용할 수 있습니다.

##### 저전력 하드웨어 설계 기법

1. **저전력 마이크로컨트롤러 선택**:
   - 저전력 모드를 지원하는 마이크로컨트롤러를 선택합니다.
   - 필요한 성능을 제공하면서도 전력 소비가 적은 마이크로컨트롤러를 사용합니다.

2. **전압 및 클럭 최적화**:
   - 동적 전압 및 주파수 스케일링(DVFS)을 사용하여 성능 요구에 따라 전압과 클럭 속도를 조절합니다.
   - 필요할 때만 고속 클럭을 사용하고, 그렇지 않을 때는 저속 클럭으로 전환합니다.

3. **전력 도메인 분할**:
   - 시스템을 여러 전력 도메인으로 분할하여, 사용하지 않는 도메인은 전원을 차단합니다.
   - 이를 통해 불필요한 전력 소비를 줄일 수 있습니다.

4. **전력 효율적 주변 장치 사용**:
   - 저전력 센서, 통신 모듈 등을 사용하여 전체 시스템의 전력 소비를 줄입니다.

##### 저전력 소프트웨어 설계 기법

1. **저전력 모드 활용**:
   - 마이크로컨트롤러의 저전력 모드를 적절히 사용하여 전력 소비를 줄입니다. 예를 들어, 슬립 모드, 대기 모드, 딥 슬립 모드 등이 있습니다.
   - 사용하지 않는 주변 장치를 비활성화하고, 필요한 경우에만 활성화합니다.

2. **효율적인 코드 작성**:
   - 코드 최적화를 통해 불필요한 연산을 줄입니다.
   - 인터럽트를 사용하여 필요한 작업이 발생할 때만 마이크로컨트롤러를 깨웁니다.

3. **타이머 및 이벤트 기반 설계**:
   - 주기적으로 폴링하는 대신, 타이머와 이벤트 기반 설계를 사용하여 필요한 경우에만 작업을 수행합니다.
   - 이를 통해 마이크로컨트롤러가 대부분의 시간 동안 저전력 모드에 있을 수 있습니다.

4. **데이터 전송 최적화**:
   - 무선 통신 시 전송 주기를 최적화하여 데이터 전송 빈도를 줄입니다.
   - 데이터 압축을 사용하여 전송할 데이터 양을 줄입니다.

##### 예제: STM32에서 저전력 모드 사용

STM32 마이크로컨트롤러에서 저전력 모드를 사용하는 예제를 설명합니다. 여기서는 슬립 모드를 사용하여 전력 소비를 줄이는 방법을 다룹니다.

**예제 코드**:
```c
#include "stm32f4xx_hal.h"

void SystemClock_Config(void);
void GPIO_Init(void);
void EnterSleepMode(void);

int main(void) {
    HAL_Init();
    SystemClock_Config();
    GPIO_Init();

    while (1) {
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5);
        HAL_Delay(1000);

        EnterSleepMode(); // 슬립 모드 진입
    }
}

void SystemClock_Config(void) {
    // 시스템 클럭 설정
}

void GPIO_Init(void) {
    __HAL_RCC_GPIOA_CLK_ENABLE();

    GPIO_InitTypeDef GPIO_InitStruct = {0};
    GPIO_InitStruct.Pin = GPIO_PIN_5;
    GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
    GPIO_InitStruct.Pull = GPIO_NOPULL;
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}

void EnterSleepMode(void) {
    HAL_PWR_EnterSLEEPMode(PWR_MAINREGULATOR_ON, PWR_SLEEPENTRY_WFI);
}
```

**코드 설명**:
- **HAL_PWR_EnterSLEEPMode()**: 마이크로컨트롤러를 슬립 모드로 전환합니다. 이 함수는 전력을 절약하기 위해 CPU를 멈추고, 인터럽트가 발생할 때까지 대기합니다.
- **HAL_GPIO_TogglePin()**: GPIO 핀의 상태를 토글하여 LED를 깜박이게 합니다.
- **HAL_Delay()**: 1초 동안 지연합니다.

##### 전력 모드 요약

| 전력 모드            | 특징                                                      | 소비 전력          |
|---------------------|-----------------------------------------------------------|-------------------|
| **활성 모드 (Run)** | 모든 기능이 활성화되어 최대 성능을 발휘합니다.                | 최대               |
| **슬립 모드 (Sleep)** | CPU를 멈추고 인터럽트가 발생할 때까지 대기합니다.             | 중간               |
| **대기 모드 (Standby)** | 대부분의 기능을 비활성화하고, 최소한의 전력만 소비합니다.       | 낮음               |
| **딥 슬립 모드 (Deep Sleep)** | 거의 모든 기능을 비활성화하고, 최저 전력 소비를 목표로 합니다. | 매우 낮음          |

저전력 설계 기법을 통해 임베디드 시스템의 전력 소비를 줄이고, 배터리 수명을 연장할 수 있습니다. 하드웨어와 소프트웨어 모두에서 전력 효율성을 고려하여 설계하는 것이 중요합니다.
